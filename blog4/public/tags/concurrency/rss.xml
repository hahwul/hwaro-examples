<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>DevLog - Tags: concurrency</title>
    <link>http://localhost:3000</link>
    <description>Today I Learned &amp; Changelog</description>
    <atom:link href="http://localhost:3000/tags/concurrency/rss.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>TIL: Crystal Fibers for Concurrency</title>
      <link>http://localhost:3000/log/til-crystal-fibers/</link>
      <guid>http://localhost:3000/log/til-crystal-fibers/</guid>
      <description>&lt;p&gt;Today I learned how Crystal handles concurrency with &lt;strong&gt;Fibers&lt;/strong&gt; — lightweight green threads managed by the runtime.&lt;/p&gt;
&lt;h2 id=&quot;the-basics&quot;&gt;The basics&lt;/h2&gt;
&lt;p&gt;Crystal uses &lt;code&gt;spawn&lt;/code&gt; to create a fiber and &lt;code&gt;Channel&lt;/code&gt; to communicate between them:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-crystal hljs&quot;&gt;ch = Channel(Int32).new

spawn do
  result = expensive_computation()
  ch.send(result)
end

# Do other work while fiber runs
value = ch.receive
puts &amp;quot;Got: #{value}&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;key-takeaways&quot;&gt;Key takeaways&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Fibers are &lt;strong&gt;cooperative&lt;/strong&gt;, not preemptive — they yield at IO boundaries&lt;/li&gt;
&lt;li&gt;A &lt;code&gt;Channel&lt;/code&gt; is typed and can be buffered or unbuffered&lt;/li&gt;
&lt;li&gt;Use &lt;code&gt;select&lt;/code&gt; for waiting on multiple channels&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Fibers are incredibly cheap to create. Spawning 100k fibers is totally fine.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;gotchas&quot;&gt;Gotchas&lt;/h2&gt;
&lt;p&gt;Be careful with shared mutable state. Crystal doesn&apos;t have a borrow checker — it&apos;s up to you to avoid data races:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-crystal hljs&quot;&gt;# BAD: shared mutable array
results = [] of Int32
10.times do |i|
  spawn { results &amp;lt;&amp;lt; i }
end
sleep 0.1

# GOOD: use a channel instead
ch = Channel(Int32).new
10.times do |i|
  spawn { ch.send(i) }
end
10.times { results &amp;lt;&amp;lt; ch.receive }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;{{&amp;lt; alert type=&amp;quot;tip&amp;quot; message=&amp;quot;Always prefer channels over shared state for inter-fiber communication.&amp;quot; &amp;gt;}}&lt;/p&gt;
</description>
      <pubDate>Wed, 11 Jun 2025 15:00:00 +0000</pubDate>
    </item>
  </channel>
</rss>
